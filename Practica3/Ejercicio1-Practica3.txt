program Ej1P3;
Uses crt;
type

  empleado = record
    nroEmp : integer;
    apellido : String[25];
    nombre : String[25];
    edad : integer;
    dni : integer;
  end;

  archivo_Empleados = file of empleado;

procedure leer(var emp : empleado);
begin

  write('Ingrese apellido ');
  readln(emp.apellido);
  if(emp.apellido <> 'fin') then begin
    write('Ingrese nro de empleado ');
    readln(emp.nroEmp);
    write('Ingrese nombre ');
    readln(emp.nombre);
    write('Ingrese edad ');
    readln(emp.edad);
    write('Ingrese dni ');
    readln(emp.dni);
  end;

end;

procedure cargarDatos(var empleados : archivo_Empleados);
var
 emp : empleado;
begin
  rewrite(empleados);
  
  leer(emp);
  while(emp.apellido <> 'fin') do begin
    writeln;
    write(empleados, emp);
    leer(emp);
  end;
  
  close(empleados);
end;


var
   empleados : archivo_Empleados;
   nombreArchivo : String[12];
   regE, aux : empleado;
   op, cant, i, nro : integer;
begin
  clrscr;
  cant := 0;

  write('Ingrese nombre del archivo ');
  readln(nombreArchivo);

  assign(empleados, nombreArchivo);

  writeln;
  writeln('1 para cargar datos');
  writeln('2 para ver todos los empleados');
  writeln('3 para ver los empleados proximos a jubilarse');
  writeln('4 para agregar empleados al archivo');
  writeln('5 para eliminar un registro');
  writeln;
  write('Ingrese la opcion que desea ');
  readln(op);

  case op of
    1: begin
         writeln;
         cargarDatos(empleados);
       end;

    2: begin
         writeln;
         writeln('Todos los empleados');
         reset(empleados);
         while(not eof(empleados)) do begin
           read(empleados, regE);
           writeln(regE.nroEmp,' ',regE.apellido,' ',regE.edad,' a¤os dni ',regE.dni);
         end;
         close(empleados);
       end;

     3: begin
          writeln;
          writeln('Empleados mayores de 70 a¤os, proximos a jubilarse');
          reset(empleados);
          while(not eof(empleados)) do begin
            read(empleados, regE);
            if(regE.edad >= 70) then
              writeln(regE.apellido,' ',regE.edad,' a¤os dni ',regE.dni);
          end;
          close(empleados);
        end;

     4: begin
          write('ingrese cuantos empleados quiere agregar ');
          readln(cant);
          reset(empleados);
          seek(empleados, filesize(empleados));
          for i := 1 to cant do begin
            leer(e);
            write(empleados, e);
          end;
          close(empleados);
        end;

     5: begin
          reset(arch);
          write('Ingrese codigo del empleado que desea eliminar ');
          readln(cod);
          while(cod <> -1) do begin
            seek(arch, filesize(arch)-1);
            read(arch,aux);
            seek(arch,0);
            read(arch,reg);
            while(not eof(arch)) and (reg.nro <> cod) do
              read(arch,reg);
            if(reg.nro = cod) then begin
              seek(arch, filepos(arch)-1);
              write(arch,aux);
              seek(arch, filesize(arch)-1);
              truncate(arch);
            end
            else
              writeln('El codigo ingresado no existe');
            write('Ingrese codigo del empleado que desea eliminar ');
            readln(cod);
          end;
          close(arch);
          todosLosEmpleados(arch);
        end
    else
      writeln('Opcion incorrecta');
  end;

  readln;
end.
